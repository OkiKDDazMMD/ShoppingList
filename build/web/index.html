<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>test count</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    /* ç°¡å˜ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
    body {
      margin: 0;
      padding: 0;
      overflow: hidden; /* Flutterã‚¢ãƒ—ãƒªãŒå…¨ç”»é¢è¡¨ç¤ºã•ã‚Œã‚‹éš›ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ãŒå‡ºãªã„ã‚ˆã†ã« */
    }
    #login-container {
      font-family: sans-serif;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 2rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
      background-color: white;
      z-index: 10; /* Flutterã‚¢ãƒ—ãƒªã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã« */
    }
    #login-container input {
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 200px;
    }
    #login-container button {
      padding: 0.75rem 1.5rem;
      background-color: #4285F4; /* Google Blue */
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    #login-container button:hover {
      background-color: #357ae8;
    }
    #login-error {
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    #flutter-container {
      /* æœ€åˆã¯Flutterã®è¡¨ç¤ºé ˜åŸŸã‚’éš ã—ã¦ãŠã */
      display: none;
      /* Flutterã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ç”»é¢å…¨ä½“ã‚’ä½¿ã†ã‚ˆã†ã«ã™ã‚‹ */
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5; /* ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã« */
    }
  </style>
</head>

<body>
  <div id="login-container">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</h2>
    <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required><br><br>
    <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required><br><br>
    <button id="login-button">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <p id="login-error" style="color: red;"></p>
  </div>

  <div id="flutter-container"></div>

  <!-- ... Firebase SDKs ã¯é€šå¸¸ <head> ã‹ã€ä¸Šè¨˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‰ã«ç½®ãã“ã¨ãŒå¤šã„ã§ã™ãŒã€ã“ã“ã§ã¯å ´æ‰€è‡ªä½“ã¯ç›´æ¥çš„ãªå•é¡Œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ ... -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    // Firebaseã®åˆæœŸåŒ–
    const firebaseConfig = {
      apiKey: "AIzaSyBIjgEC3Cu8c5X9UxhgmZzxeFnn8NceigI",
      authDomain: "friendlyeats-6010d.firebaseapp.com",
      projectId: "friendlyeats-6010d",
      storageBucket: "friendlyeats-6010d.firebasestorage.app",
      messagingSenderId: "1064013134599",
      appId: "1:1064013134599:web:9a14d3c4962f4be44863a2",
      measurementId: "G-36QDXF9CEL"
    };
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    // â–¼â–¼â–¼ å¤‰æ›´ç‚¹: ã“ã“ã‹ã‚‰ãŒä¸»è¦ãªãƒ­ã‚¸ãƒƒã‚¯ â–¼â–¼â–¼
    // DOMè¦ç´ ã®å‚ç…§ã‚’å–å¾—
    const loginContainer = document.getElementById('login-container');
    const flutterContainer = document.getElementById('flutter-container');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const loginButton = document.getElementById('login-button');
    const loginError = document.getElementById('login-error');

    let flutterScriptsLoaded = false; // Flutterã®JSãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°
    let flutterAppStarted = false;    // Flutterã‚¢ãƒ—ãƒªè‡ªä½“ãŒèµ·å‹•ã•ã‚ŒãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

    /**
     * Flutterã‚¢ãƒ—ãƒªã‚’åˆæœŸåŒ–ã—ã¦èµ·å‹•ã™ã‚‹é–¢æ•°
     */
    function startFlutterApp() {
        if (flutterAppStarted) {
            // ã‚¢ãƒ—ãƒªãŒæ—¢ã«èµ·å‹•æ¸ˆã¿ãªã‚‰ã€è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã ã‘ã§OK
            loginContainer.style.display = 'none';
            flutterContainer.style.display = 'block';
            return;
        }

        // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’éš ã—ã€Flutterã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
        loginContainer.style.display = 'none';
        flutterContainer.style.display = 'block';

        // Flutterã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã¾ã ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã‘ã‚Œã°ã€å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
        if (!flutterScriptsLoaded) {
            // flutter.js ã‚’å‹•çš„ã«ãƒ­ãƒ¼ãƒ‰
            const flutterJsScript = document.createElement('script');
            flutterJsScript.src = 'flutter.js'; // `flutter build web`ã§ç”Ÿæˆã•ã‚Œã‚‹`flutter.js`ã®ãƒ‘ã‚¹
            flutterJsScript.defer = true; // é…å»¶ãƒ­ãƒ¼ãƒ‰
            
            // flutter.jsãŒãƒ­ãƒ¼ãƒ‰å®Œäº†ã—ãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†
            flutterJsScript.onload = () => {
                flutterScriptsLoaded = true; // ãƒ­ãƒ¼ãƒ‰æ¸ˆã¿ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹

                // `flutter.js`ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨`_flutter.loader`ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
                // ã“ã“ã§Flutterã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚
                _flutter.loader.loadEntrypoint({
                    hostElement: flutterContainer, // Flutterã‚¢ãƒ—ãƒªã‚’è¡¨ç¤ºã™ã‚‹HTMLè¦ç´ 
                    onEntrypointLoaded: function(engineInitializer) {
                        engineInitializer.initializeEngine().then(function(appRunner) {
                            appRunner.runApp(); // Flutterã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œ
                            flutterAppStarted = true; // ã‚¢ãƒ—ãƒªèµ·å‹•å®Œäº†
                            console.log('ğŸ‰ Flutterã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸï¼');
                        });
                    }
                });
            };
            // ç”Ÿæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°ã‚’<body>ã®æœ€å¾Œã«è¿½åŠ ã—ã¦ã€ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹
            document.body.appendChild(flutterJsScript);
        }
    }

    /**
     * Firebaseã®èªè¨¼çŠ¶æ…‹ã‚’ç›£è¦–ã™ã‚‹
     */
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹å ´åˆ
        console.log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã™ã€‚Flutterã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ã€‚');
        startFlutterApp(); // Flutterã‚¢ãƒ—ãƒªèµ·å‹•å‡¦ç†ã‚’å‘¼ã³å‡ºã™
      } else {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆ
        console.log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚');
        loginContainer.style.display = 'block';
        flutterContainer.style.display = 'none';
        // ã‚‚ã—Flutterã‚¢ãƒ—ãƒªãŒæ—¢ã«èµ·å‹•ã—ã¦ã„ãŸå ´åˆï¼ˆä¾‹: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ï¼‰ã€
        // ãã®è¡¨ç¤ºã‚’éš ã™ãŸã‚ã«flutterContainerã‚’display:noneã«ã—ã¦ã„ã¾ã™ã€‚
        // Flutterã‚¢ãƒ—ãƒªè‡ªä½“ã‚’å®Œå…¨ã«åœæ­¢ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€ã‚ˆã‚Šè¤‡é›‘ãªå¯¾å¿œãŒå¿…è¦ã§ã™ã€‚
        // é€šå¸¸ã¯Flutterã‚¢ãƒ—ãƒªå†…ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚’æ¤œçŸ¥ã—ã€é©åˆ‡ãªç”»é¢ã«é·ç§»ã•ã›ã‚‹ã®ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚
      }
    });

    /**
     * ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
     */
    loginButton.addEventListener('click', function() {
      const email = emailInput.value;
      const password = passwordInput.value;
      
      loginError.textContent = ''; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢

      // Firebase Authenticationã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã‚’è©¦ã¿ã‚‹
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼
          // onAuthStateChanged ãŒè‡ªå‹•çš„ã«æ¤œçŸ¥ã—ã¦ startFlutterApp ã‚’å‘¼ã³å‡ºã™ã®ã§ã€
          // ã“ã“ã§ã¯ç‰¹ã«ä½•ã‚‚ã—ãªãã¦ã‚‚è‰¯ã„ã§ã™ã€‚
          console.log('ğŸš€ ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸï¼', userCredential.user);
        })
        .catch((error) => {
          // ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—
          console.error('âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
          let errorMessage = 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
          if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
              errorMessage = 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚';
          } else if (error.code === 'auth/invalid-email') {
              errorMessage = 'ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã™ã€‚';
          } else if (error.code === 'auth/user-disabled') {
              errorMessage = 'ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ç„¡åŠ¹ã«ãªã£ã¦ã„ã¾ã™ã€‚';
          }
          loginError.textContent = errorMessage; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        });
    });
    
  </script>

</body>
</html>